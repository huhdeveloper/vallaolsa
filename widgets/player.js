!function(a){var b={};b.DEBUG=!1,b.POST_MESSAGE=!!a.postMessage,b.origin=function(b){return"//"===b.substr(0,2)&&(b=a.location.protocol+b),b.split("/").slice(0,3).join("/")},b.addEvent=function(a,b,c){a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)},b.log=function(){b.log.history=b.log.history||[],b.log.history.push(arguments),a.console&&b.DEBUG&&a.console.log(Array.prototype.slice.call(arguments))},b.Listeners=function(){this.init()},b.Listeners.prototype.init=function(){this.data={}},b.Listeners.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)})},b.Listeners.prototype.has=function(a){return this.data.hasOwnProperty(a)},b.Listeners.prototype.add=function(a,b,c,d,e){var f={event:b,cb:c,ctx:d,one:e};this.has(a)?this.data[a].push(f):this.data[a]=[f]},b.Listeners.prototype.execute=function(b,c){if(!this.has(b))return!1;for(var d=[],e=0;e<this.data[b].length;e++){var f=this.data[b][e];f.cb.call(f.ctx?f.ctx:a,c),f.one===!1&&d.push(f)}0===d.length?delete this.data[b]:this.data[b]=d},b.Listeners.prototype.on=function(a,b,c,d){this.add(a,b,c,d,!1)},b.Listeners.prototype.one=function(a,b,c,d){this.add(a,b,c,d,!0)},b.Listeners.prototype.off=function(a,b){var c=[];for(var d in this.data)c.push(d);var e=[];for(var f in c){var g=this.data[c[f]],h=[];for(var i in g){var j=g[i];j.event===a&&j.cb===b?e.push(c[f]):h.push(j)}0===h.length?delete this.data[c[f]]:this.data[c[f]]=h}return e},b.Player=function(a){this.init(a)},b.Player.EVENTS={PLAY:"play",PAUSE:"pause",FINISH:"finish",SEEK:"seek",PLAY_PROGRESS:"playProgress",LOAD_PROGRESS:"load-progress"},b.Player.prototype.init=function(c){if(this.elem=c,this.origin=b.origin(c.src),this.listeners=new b.Listeners,this.isReady=!1,this.queue=[],b.POST_MESSAGE){var d=this;b.addEvent(a,"message",function(a){d.receive(a)})}else b.log("Post Message is not Available.")},b.Player.prototype.send=function(a,c,d){if(c){var e=this.listeners.getUUID();a.listener=e,this.listeners.one(e,null,c,d)}return this.isReady?(b.log("Player.send",a,this.origin),this.elem.contentWindow.postMessage(JSON.stringify(a),this.origin),!0):(this.queue.push(a),!1)},b.Player.prototype.receive=function(a){if(b.log("Player.receive",a),a.origin!==this.origin)return!1;var c;try{c=JSON.parse(a.data)}catch(d){return!1}"ready"===c.method&&this.ready(),this.listeners.has(c.listener)&&this.listeners.execute(c.listener,c.value)},b.Player.prototype.ready=function(){if(this.isReady===!0)return!1;this.isReady=!0;for(var a=0;a<this.queue.length;a++)b.log("Player.dequeue",this.queue[a]),this.send(this.queue[a]);this.queue=[]},b.Player.prototype.connect=function(a,b){var c=this.listeners.getUUID();this.listeners.one(c,"ready",a,b),this.isReady?this.listeners.execute(c):this.elem.contentWindow.postMessage(JSON.stringify({method:"ready",listener:c}),this.origin)},b.Player.prototype.on=function(a,b,c){var d=this.listeners.getUUID();return this.listeners.on(d,a,b,c),this.send({method:"addEventListener",event:a,listener:d}),!0},b.Player.prototype.off=function(a,b){var c=this.listeners.off(a,b);if(c.length>0)for(var d in c)return this.send({method:"removeEventListener",event:a,listener:c[d]}),!0;return!1},b.Player.prototype.play=function(){this.send({method:"play"})},b.Player.prototype.pause=function(){this.send({method:"pause"})},b.Player.prototype.paused=function(a,b){this.send({method:"paused"},a,b)},b.Player.prototype.mute=function(){this.send({method:"mute"})},b.Player.prototype.unmute=function(){this.send({method:"unmute"})},b.Player.prototype.isMuted=function(a,b){this.send({method:"isMuted"},a,b)},b.Player.prototype.getVolume=function(a,b){this.send({method:"getVolume"},a,b)},b.Player.prototype.setVolume=function(a){this.send({method:"setVolume",value:a})},b.Player.prototype.getDuration=function(a,b){this.send({method:"getDuration"},a,b)},b.Player.prototype.seekTo=function(a){this.send({method:"seekTo",value:a})},b.Player.prototype.currentTime=function(a,b){this.send({method:"currentTime"},a,b)},a.OP=b}(window,document);